<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Baca Berita</ion-title>
  </ion-toolbar>

  <style>
    .ion-margin-bottom {
      text-align: center;
      --min-height: 32px;
      font-size: 12px;
      margin: 0;
    }

    .reply-comment {
      margin-left: 8px;
    }
  </style>

</ion-header>

<ion-content [fullscreen]="true">
  <ion-list>
    <ng-container *ngIf="berita">
      <h2>{{ berita.judul }}</h2>

      <ion-item lines="none">
        <ion-label class="meta">
          <h2>{{ berita.nama_lengkap }}</h2>

          <p>
            <ion-icon name="calendar-outline"></ion-icon>
            {{ berita.tanggal_dibuat }} â€¢ OnNews
          </p>

          <div class="kategori">
            <ion-chip *ngFor="let k of berita.kategori" color="primary">
              {{ k }}
            </ion-chip>
          </div>
        </ion-label>
      </ion-item>


      <ion-grid>
        <ion-row>
          <ion-col size="6" *ngFor="let img of berita.gambar">
            <ion-card>
              <img [src]="img" />
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>

      <p>{{ berita.deskripsi }}</p>
    </ng-container>


    <ion-list>
      <!-- <ion-item lines="none">Comments ({{totalKomentar}}): </ion-item>
      <ion-item *ngFor="let k of berita[index].komentar; let i = index">
        <ion-label>
          <h3 style="font-weight: bold;">{{ k.username }} :</h3>
          <p>{{ k.komentar }}</p>

          <ion-button size="small" fill="clear" (click)="toggleReplyBox(i)">
            Reply
          </ion-button>

          <div *ngIf="replyIndex == i" style="margin-top: 8px;">
            <ion-input placeholder="Tulis balasan..." [(ngModel)]="newReply"></ion-input>
            <ion-button size="small" (click)="addReply(i)">Kirim</ion-button>
          </div>

          <div *ngIf="k.reply && k.reply.length > 0">
            <ion-label *ngFor="let r of k.reply">
              <h4 class="reply-comment">{{ r.username }}: {{r.komentar}}</h4>
            </ion-label>
          </div>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-label *ngIf="berita[index].komentar.length == 0" lines="none">
          Belum ada komentar.
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-input placeholder="Write your comments.." [(ngModel)]="newComment"></ion-input>
      </ion-item>
      <ion-button (click)="submitComment()">Kirim</ion-button>

      <ion-item lines="none">Ratings: </ion-item>
      <ion-item>
        <ion-label>
          <p>{{overallRating(berita[index])}}</p>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-input type="number" [(ngModel)]="newRating" min="1" max="5"></ion-input>
      </ion-item>
      <ion-button (click)="submitRating()">Kirim</ion-button> -->

      <ng-container *ngIf="berita as b">

        <ion-item lines="none">
          Comments ({{ b.komentar.length }})
        </ion-item>

        <ion-item *ngFor="let k of b.komentar; let i = index">
          <ion-label>
            <h3 style="font-weight: bold;">
              {{ k.username }} :
            </h3>

            <p>{{ k.isi }}</p>

            <ion-button size="small" fill="clear" (click)="toggleReplyBox(i)">
              Reply
            </ion-button>

            <div *ngIf="replyIndex === i" style="margin-top: 8px;">
              <ion-input placeholder="Tulis balasan..." [(ngModel)]="newReply">
              </ion-input>
              <ion-button size="small" (click)="addReply(i)">
                Kirim
              </ion-button>
            </div>

            <div *ngIf="k.reply?.length > 0">
              <ion-label *ngFor="let r of k.reply">
                <h4 class="reply-comment">
                  {{ r.username }}: {{ r.komentar }}
                </h4>
              </ion-label>
            </div>

          </ion-label>
        </ion-item>

        <ion-item *ngIf="b.komentar.length === 0">
          <ion-label lines="none">
            Belum ada komentar.
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-input placeholder="Write your comments.." [(ngModel)]="newComment">
          </ion-input>
        </ion-item>

        <ion-button expand="block" (click)="submitComment()">
          Kirim
        </ion-button>

        <ion-item lines="none">Ratings:</ion-item>
        <ion-item>
          <ion-label>
            <p>{{ berita?.avg_rating | number:'1.1-1' }}</p>
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-input type="number" [(ngModel)]="newRating" min="1" max="5"></ion-input>
        </ion-item>
        <ion-button (click)="submitRating()">Kirim</ion-button>

      </ng-container>

      <ion-item lines="none">
        <ion-button *ngIf="news_added === false" expand="block" color="warning" (click)="addToFavorites()">
          <ion-icon slot="start" name="heart"></ion-icon>
          Tambahkan ke Favorit
        </ion-button>
      </ion-item>

    </ion-list>
  </ion-list>
</ion-content>